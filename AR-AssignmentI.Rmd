---
title: "AR - Assignment I"
author: "Roger Bukuru"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Question 1

```{r}
library(ggplot2)
library(tidyverse)

rm(list=ls())

# Define x
x = seq(0,1, length.out=100)

#x = rnorm(100,0,1)
# We choose equally spaced notes over the range [0,1]
knots = seq(0,1,length.out=6)

# Basis functions per Woods formulation

b1 = function(x) {
  rep(1, length(x))
}

b2 = function(x){
  x
}

R_x_z = function(x, z) {
  ((z - 0.5)^2 - 1/12) * ((x - 0.5)^2 - 1/12) / 4 - 
  ((abs(x - z) - 0.5)^4 - 0.5 * (abs(x - z) - 0.5)^2 + 7/240) / 24
}

# Construct the basis matrix

basis_matrix = cbind(b1(x), b2(x),sapply(knots[-c(1,length(knots))],function(k) R_x_z(x,k)))

basis_design_matrix = basis_matrix %>% as_tibble()
                  
colnames(basis_design_matrix) = c("b1", "b2", "b3", "b4", paste0("b", 5:(4 + length(knots))))
basis_design_matrix = basis_design_matrix %>%
                       mutate(x = x)

basis_melted <- reshape2::melt(basis_design_matrix, id.vars = "x")

ggplot(basis_melted, aes(x = x, y = value, color = variable)) + 
  geom_line(size = 1) + 
  labs(title = "Wood Cubic Spline Basis",
       x = "x", y = "Basis Function Value", color = "Basis") +
  #xlim(0, 1) + 
  theme_minimal()

```



```{r}
# Simulate the data
set.seed(1)
n <- 100
x = rnorm(n,0,1)
#mu = 5 + sin(3 * pi * (x-0.6))
#y <-  rnorm(100, mean = mu, sd = 0.5^2)

y <- 5 + sin(3 * pi * (x-0.6)) + rnorm(n, sd = 0.5^2)


# Define the range for x for fitting
x_fit <- seq(-3, 3, length.out = 100)

# Define the knot locations for fitting
knots_fit <- seq(-3, 3, length.out = 30)

# Construct the basis matrix for fitting
basis_matrix_fit <- cbind(
  b1(x),
  b2(x),
  sapply(knots_fit[-c(1, length(knots_fit))], function(k) R_x_z(x, k))
)

# Fit the penalized regression spline
library(mgcv)
fit <- gam(y ~ s(x, bs = "ps", k = 30))

# Predict using the fitted model
pred <- predict(fit, newdata = data.frame(Xi = x_fit))

# Plot the fitted spline and the original data
plot(x, y, main = "Penalized Regression Spline Fit", xlab = "x", ylab = "y", pch = 16)
lines(x_fit, pred, col = "blue", lwd = 2)

```



```{r}
pulsar_data = read.csv2("Pulsar.csv", header = TRUE, sep=",")
head(pulsar_data)
```

```{r}

```